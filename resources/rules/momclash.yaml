# ==========================================
# ğŸš€ Clash Meta (Mihomo) å¤©èŠ±æ¿çº§ä¸“ä¸šé…ç½®
# æ ¸å¿ƒç‰¹æ€§ï¼šSplit DNS / æµé‡å—…æ¢ / æ™ºèƒ½åˆ†æµ
# åŒ…å«ä¼˜åŒ–ï¼šTikTok ä¸“å±åŠ é€Ÿ (ä¿®å¤ç‰ˆ)
# ==========================================

# ==========================================
# ğŸ’¾ ç¼“å­˜æŒä¹…åŒ– (è§£å†³æ›´æ–°åæ–­ç½‘é—®é¢˜)
# ==========================================
profile:
  store-fake-ip: true
  store-selected: true

port: 7890
socks-port: 7891
redir-port: 7892
tproxy-port: 7893
mixed-port: 7890

allow-lan: true
bind-address: "*"
mode: rule
log-level: info
ipv6: true
external-controller: 127.0.0.1:9090

# ğŸŒŸ å¤©èŠ±æ¿ç‰¹æ€§ï¼šæµé‡å—…æ¢ (Sniffer)
sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
      override-destination: true
    QUIC:
      ports: [443, 8443]
      override-destination: false

# ğŸŒŸ å¤©èŠ±æ¿ç‰¹æ€§ï¼šTCP å¹¶å‘
tcp-concurrent: true

# ==========================================
# ğŸ›¡ï¸ ç»ˆæ DNS é…ç½® (Split DNS)
# ==========================================
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  use-hosts: true
  respect-rules: true

  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29

  proxy-server-nameserver:
    - quic://154.219.104.214
    - quic://103.20.222.133
    - tls://103.20.222.133
    - tls://154.219.104.214
    - tls://154.219.96.225
    - quic://154.219.96.225

  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query

  fallback:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
    - https://dns.google/dns-query
    - tls://8.8.4.4:853

  nameserver-policy: 
    "geosite:geolocation-!cn": [https://dns.google/dns-query, https://1.1.1.1/dns-query]
    "geosite:cn": [https://dns.alidns.com/dns-query, https://doh.pub/dns-query]
    "+.browserleaks.com": [https://dns.google/dns-query]
    "geosite:!cn": [https://dns.google/dns-query]

  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.x.com'
      - '+.twitter.com'
      - '+.telegram.org'
      - '+.pornhub.com'
      - '+.phncdn.com'
      - '+.xvideos.com'
      - '+.jable.tv'
      - '+.xnxx.com'
      - '+.googleapis.com'
      - '+.googleusercontent.com'
      - '+.ggpht.com'
      - '+.gvt1.com'
      - '+.gstatic.com'
      - '+.android.com'
      - '+.gvt0.com'
      - '+.gvt2.com'
      - '+.gvt3.com'
      - '+.1e100.net'
      - '+.crashlytics.com'
      - '+.app-measurement.com'
      - '+.github.com'
      - '+.githubusercontent.com'
      - '+.githubassets.com'
      - '+.tiktok.com'
      - '+.tiktokv.com'
      - '+.tiktokcdn.com'
      - '+.byteoversea.com'
      - '+.ibytedtos.com'
      - '+.cloudflare.com'
      - '+.cloudflare.net'
      - '+.cloudflare.org'
      - '+.docker.com'
      - '+.docker.io'
      - '+.docker.net'
      - '+.docker.sh'

# ==========================================
# ä»£ç†ç»„ç­–ç•¥ (Proxy Groups)
# ==========================================
proxies:
  # å ä½ç¬¦ç•™ç»™ v2board è‡ªåŠ¨å¡«å……èŠ‚ç‚¹
  
proxy-groups:
  # ------------------------------------------
  # âš¡ è‡ªåŠ¨æµ‹é€Ÿç»„ (å¸¦æŠ—æŠ–åŠ¨)
  # ------------------------------------------
  - name: ğŸ‡­ğŸ‡° é¦™æ¸¯è‡ªåŠ¨
    type: url-test
    url: http://www.google.com/generate_204
    interval: 300
    tolerance: 50
    proxies:
      - "/(?i)(HK|Hong|Kong|é¦™æ¸¯)/u"
    
  - name: ğŸ‡¹ğŸ‡¼ å°æ¹¾è‡ªåŠ¨
    type: url-test
    url: http://www.google.com/generate_204
    interval: 300
    tolerance: 50
    proxies:
      - "/(?i)(TW|Tai|Wan|å°æ¹¾)/u"

  - name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬è‡ªåŠ¨
    type: url-test
    url: http://www.google.com/generate_204
    interval: 300
    tolerance: 50
    proxies:
      - "/(?i)(JP|Japan|æ—¥æœ¬)/u"

  - name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡è‡ªåŠ¨
    type: url-test
    url: http://www.google.com/generate_204
    interval: 300
    tolerance: 50
    proxies:
      - "/(?i)(SG|Singapore|ç‹®åŸ|æ–°åŠ å¡)/u"

  - name: ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨
    type: url-test
    url: http://www.google.com/generate_204
    interval: 300
    tolerance: 50
    proxies:
      - "/(?i)(US|United|States|ç¾å›½)/u"
      
  - name: ğŸ‡°ğŸ‡· éŸ©å›½è‡ªåŠ¨
    type: url-test
    url: http://www.google.com/generate_204
    interval: 300
    tolerance: 50
    proxies:
      - "/(?i)(KR|Korea|éŸ©å›½)/u"

  # ------------------------------------------
  # ğŸš€ æ ¸å¿ƒé€‰æ‹©ç»„ (ä¸»è¦å…¥å£)
  # ------------------------------------------
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies:
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
      - ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
      - ğŸµ TikTok    # æ­¤å¤„å·²åŠ å…¥ TikTok å…¥å£      
      - ğŸŒ å…¨éƒ¨èŠ‚ç‚¹
      - ğŸš‘ æ•…éšœè½¬ç§»
      - DIRECT

  # ------------------------------------------
  # ğŸ› ï¸ åŠŸèƒ½åˆ†ç»„
  # ------------------------------------------
  - name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    proxies:
      - "/^(?!.*(å‰©ä½™|åˆ°æœŸ|è¿‡æœŸ|æ—¶é—´|æœ‰æ•ˆ|ç¾¤|å®˜ç½‘)).*$/u"

  - name: ğŸš‘ æ•…éšœè½¬ç§»
    type: fallback
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies:
      - "/^(?!.*(å‰©ä½™|åˆ°æœŸ|è¿‡æœŸ|æ—¶é—´|æœ‰æ•ˆ|ç¾¤|å®˜ç½‘)).*$/u"

  - name: ğŸŒ å›½å¤–åª’ä½“
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
      - ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
      - ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹

  - name: ğŸ“² ç”µæŠ¥ä¿¡æ¯
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯è‡ªåŠ¨
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡è‡ªåŠ¨
      - ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨

  - name: ğŸ¤– äººå·¥æ™ºèƒ½
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬è‡ªåŠ¨
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡è‡ªåŠ¨
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾è‡ªåŠ¨

  # ------------------------------------------
  # ğŸµ TikTok ä¸“å±ç»„ (ä¿®æ­£ç‰ˆï¼šå½»åº•æ‰“ç ´æ­»å¾ªç¯)
  # ------------------------------------------
  - name: ğŸµ TikTok
    type: select
    proxies:
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡è‡ªåŠ¨
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬è‡ªåŠ¨
      - ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨
      - ğŸŒ å…¨éƒ¨èŠ‚ç‚¹    # <-- æ³¨æ„ï¼šè¿™é‡Œä¸åŒ…å«â€œğŸš€ èŠ‚ç‚¹é€‰æ‹©â€ï¼Œé¿å…å¾ªç¯å¼•ç”¨
      - DIRECT

  - name: ğŸ è‹¹æœæœåŠ¡
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT
      - ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨

  - name: ğŸ›‘ å¹¿å‘Šæ‹¦æˆª
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT

  # ------------------------------------------
  # ğŸ“‚ åœ°åŒºèŠ‚ç‚¹æå–
  # ------------------------------------------
  - name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
    type: select
    proxies:
      - ğŸ‡­ğŸ‡° é¦™æ¸¯è‡ªåŠ¨
      - "/(?i)(HK|Hong|Kong|é¦™æ¸¯)/u"
  - name: ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
    type: select
    proxies:
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾è‡ªåŠ¨
      - "/(?i)(TW|Tai|Wan|å°æ¹¾)/u"
  - name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
    type: select
    proxies:
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬è‡ªåŠ¨
      - "/(?i)(JP|Japan|æ—¥æœ¬)/u"
  - name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
    type: select
    proxies:
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡è‡ªåŠ¨
      - "/(?i)(SG|Singapore|ç‹®åŸ|æ–°åŠ å¡)/u"
  - name: ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
    type: select
    proxies:
      - ğŸ‡ºğŸ‡¸ ç¾å›½è‡ªåŠ¨
      - "/(?i)(US|United|States|ç¾å›½)/u"
  - name: ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹
    type: select
    proxies:
      - ğŸ‡°ğŸ‡· éŸ©å›½è‡ªåŠ¨
      - "/(?i)(KR|Korea|éŸ©å›½)/u"
  - name: ğŸŒ å…¨éƒ¨èŠ‚ç‚¹
    type: select
    proxies:
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - "/^(?!.*(å‰©ä½™|åˆ°æœŸ|è¿‡æœŸ|æ—¶é—´|æœ‰æ•ˆ|ç¾¤|å®˜ç½‘)).*$/u"

# ==========================================
# ğŸ“œ è§„åˆ™é›†å¼•ç”¨ (Rule Providers)
# ==========================================
rule-providers:
  applications:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Applications/Applications.yaml"
    path: ./ruleset/applications.yaml
    interval: 86400

  private:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Private/Private.yaml"
    path: ./ruleset/private.yaml
    interval: 86400

  reject:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Hijacking/Hijacking.yaml"
    path: ./ruleset/reject.yaml
    interval: 86400

  advertising:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/privacy-protection-tools/anti-AD@master/anti-ad-clash.yaml"
    path: ./ruleset/anti-ad.yaml
    interval: 86400

  icloud:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/iCloud/iCloud.yaml"
    path: ./ruleset/icloud.yaml
    interval: 86400

  apple:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Apple/Apple.yaml"
    path: ./ruleset/apple.yaml
    interval: 86400

  google:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Google/Google.yaml"
    path: ./ruleset/google.yaml
    interval: 86400

  proxy:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Proxy/Proxy.yaml"
    path: ./ruleset/proxy.yaml
    interval: 86400

  openai:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OpenAI/OpenAI.yaml"
    path: ./ruleset/openai.yaml
    interval: 86400

  telegram:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Telegram/Telegram.yaml"
    path: ./ruleset/telegram.yaml
    interval: 86400

  tiktok:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/TikTok/TikTok.yaml"
    path: ./ruleset/tiktok.yaml
    interval: 86400

  gfw:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Global/Global.yaml"
    path: ./ruleset/gfw.yaml
    interval: 86400

  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/ChinaIPs/ChinaIPs.yaml"
    path: ./ruleset/cncidr.yaml
    interval: 86400

  lancidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/LAN/LAN.yaml"
    path: ./ruleset/lancidr.yaml
    interval: 86400
    
# ==========================================
# ğŸš¦ è§„åˆ™åŒ¹é… (Rules)
# ==========================================
rules:
  - AND,((NETWORK,UDP),(DST-PORT,443)),REJECT
  - RULE-SET,applications,DIRECT
  - DOMAIN,clash.razord.top,DIRECT
  - DOMAIN,yandex.ru,DIRECT
  - RULE-SET,private,DIRECT
  - RULE-SET,reject,ğŸ›‘ å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,advertising,ğŸ›‘ å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,lancidr,DIRECT
  - GEOIP,LAN,DIRECT
  - RULE-SET,icloud,DIRECT
  - RULE-SET,apple,ğŸ è‹¹æœæœåŠ¡
  - RULE-SET,openai,ğŸ¤– äººå·¥æ™ºèƒ½
  - RULE-SET,telegram,ğŸ“² ç”µæŠ¥ä¿¡æ¯
  - RULE-SET,tiktok,ğŸµ TikTok
  - RULE-SET,google,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,proxy,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,gfw,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,cncidr,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼