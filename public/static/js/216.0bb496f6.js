"use strict";(self.webpackChunkez_theme=self.webpackChunkez_theme||[]).push([[216],{12321:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(20641),r=n(90033),o={key:0,class:"spinner-text"};const i={name:"LoadingSpinner",props:{text:{type:String,default:""},overlay:{type:Boolean,default:!1}}};const s=(0,n(66262).A)(i,[["render",function(e,t,n,i,s,u){return(0,a.uX)(),(0,a.CE)("div",{class:(0,r.C4)(["loading-spinner",{"loading-spinner-overlay":n.overlay}])},[t[0]||(t[0]=(0,a.Lk)("div",{class:"spinner"},[(0,a.Lk)("div",{class:"spinner-circle"})],-1)),n.text?((0,a.uX)(),(0,a.CE)("div",o,(0,r.v_)(n.text),1)):(0,a.Q3)("",!0)],2)}],["__scopeId","data-v-4d20d688"]])},46510:(e,t,n)=>{n.d(t,{F$:()=>r,Hi:()=>u,RV:()=>s,Z2:()=>o,yN:()=>i});var a=n(96131);function r(){return(0,a.A)({url:"/user/ticket/fetch",method:"get"})}function o(e){return(0,a.A)({url:"/user/ticket/save",method:"post",data:e})}function i(e){return(0,a.A)({url:"/user/ticket/fetch?id=".concat(e),method:"get"})}function s(e,t){return(0,a.A)({url:"/user/ticket/reply",method:"post",data:{id:e,message:t}})}function u(e){return(0,a.A)({url:"/user/ticket/close",method:"post",data:{id:e}})}},69668:(e,t,n)=>{n.d(t,{A:()=>m});var a=n(20641),r=n(53751),o=n(90033),i={key:0,class:"ticket-popup-container"},s={class:"ticket-popup-header"},u=["innerHTML"],l={class:"ticket-popup-content"},c=["innerHTML"],d={class:"ticket-popup-footer"},p=["disabled"];n(76918),n(59089),n(23288),n(2892),n(26099),n(38781),n(76031);var f=n(50953);const v={name:"TicketPopup",components:{IconX:n(98120).MRt},props:{showPopup:{type:Boolean,default:!1},title:{type:String,default:""},content:{type:String,default:""},cooldownHours:{type:Number,default:24},closeWaitSeconds:{type:Number,default:0}},emits:["close"],setup:function(e,t){var n=t.emit,r=(0,f.KR)(!1),o=(0,f.KR)(0),i=null;return(0,a.wB)(function(){return e.showPopup},function(t){t?setTimeout(function(){r.value=!0,i&&clearInterval(i),e.closeWaitSeconds>0?(o.value=e.closeWaitSeconds,i=setInterval(function(){o.value>0?o.value-=1:clearInterval(i)},1e3)):o.value=0},1e3):(r.value=!1,i&&clearInterval(i))},{immediate:!0}),(0,a.hi)(function(){i&&clearInterval(i)}),{show:r,attemptClose:function(){if(!(o.value>0)){if(r.value=!1,e.cooldownHours>0){var t=Date.now();localStorage.setItem("ticket_popup_close_time",t.toString())}n("close")}},waitTimeRemaining:o}}};const m=(0,n(66262).A)(v,[["render",function(e,t,n,f,v,m){var g=(0,a.g2)("IconX");return(0,a.uX)(),(0,a.Wv)(r.eB,{name:"fade"},{default:(0,a.k6)(function(){return[f.show?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"ticket-popup-overlay",onClick:t[2]||(t[2]=(0,r.D$)(function(){return f.attemptClose&&f.attemptClose.apply(f,arguments)},["self"]))},[(0,a.bF)(r.eB,{name:"popup-slide"},{default:(0,a.k6)(function(){return[f.show?((0,a.uX)(),(0,a.CE)("div",i,[(0,a.Lk)("div",s,[(0,a.Lk)("h2",{class:"popup-title",innerHTML:n.title},null,8,u),(0,a.Lk)("button",{class:"popup-close-btn",onClick:t[0]||(t[0]=function(){return f.attemptClose&&f.attemptClose.apply(f,arguments)})},[(0,a.bF)(g,{size:20})])]),(0,a.Lk)("div",l,[(0,a.Lk)("div",{innerHTML:n.content},null,8,c)]),(0,a.Lk)("div",d,[(0,a.Lk)("button",{class:"popup-action-btn",onClick:t[1]||(t[1]=function(){return f.attemptClose&&f.attemptClose.apply(f,arguments)}),disabled:f.waitTimeRemaining>0},[f.waitTimeRemaining>0?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.eW)((0,o.v_)(e.$t("tickets.popup.wait_close_btn",{seconds:f.waitTimeRemaining})),1)],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,o.v_)(e.$t("tickets.popup.close_btn")),1)],64))],8,p)])])):(0,a.Q3)("",!0)]}),_:1})])):(0,a.Q3)("",!0)]}),_:1})}],["__scopeId","data-v-053c6e2c"]])},77137:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var a=n(59258),r=n(20908),o=n(30388),i=n(25026),s=n(69492),u=(n(16280),n(76918),n(28706),n(2008),n(51629),n(15086),n(26910),n(59089),n(23288),n(62010),n(18111),n(22489),n(7588),n(13579),n(9868),n(79432),n(26099),n(78459),n(38781),n(11392),n(50778),n(42207),n(23500),n(55815),n(64979),n(79739),n(76031),n(80394));const l=new(function(){return(0,s.A)(function e(){(0,i.A)(this,e),this.config=u.TICKET_CONFIG.imageUpload},[{key:"generateUniqueFileName",value:function(e){var t=Date.now(),n=Math.random().toString(36).substring(2,8),a=e.name.split(".").pop();return"".concat(t,"_").concat(n,".").concat(a)}},{key:"uploadToWebDAV",value:(g=(0,o.A)((0,r.A)().m(function e(t,n){var a,o,i,s,u;return(0,r.A)().w(function(e){for(;;)switch(e.n){case 0:if((a=this.config.webdav).serverUrl&&a.username&&a.password){e.n=1;break}throw new Error("WebDAV \u914d\u7f6e\u4e0d\u5b8c\u6574");case 1:return o=this.generateUniqueFileName(t),i="".concat(a.uploadPath,"/").concat(o),s="".concat(a.serverUrl).concat(i),u=btoa("".concat(a.username,":").concat(a.password)),e.a(2,new Promise(function(e,r){var i=new XMLHttpRequest;n&&i.upload&&i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);n(t)}}),i.addEventListener("load",function(){if(i.status>=200&&i.status<300){var n="".concat(a.publicUrl,"/").concat(o);e({success:!0,url:n,fileName:o,originalName:t.name,size:t.size})}else r(new Error("WebDAV \u4e0a\u4f20\u5931\u8d25: ".concat(i.status," ").concat(i.statusText)))}),i.addEventListener("error",function(){r(new Error("WebDAV \u4e0a\u4f20\u7f51\u7edc\u9519\u8bef"))}),i.addEventListener("timeout",function(){r(new Error("WebDAV \u4e0a\u4f20\u8d85\u65f6"))}),i.open("PUT",s),i.setRequestHeader("Authorization","Basic ".concat(u)),i.setRequestHeader("Content-Type",t.type),i.setRequestHeader("Content-Length",t.size.toString()),i.send(t)}))}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"uploadToImageBed",value:(m=(0,o.A)((0,r.A)().m(function e(t,n){return(0,r.A)().w(function(e){for(;;)switch(e.n){case 0:if(!(this.config.imageBeds&&this.config.imageBeds.length>0)){e.n=2;break}return e.n=1,this.uploadToMultipleImageBeds(t,n);case 1:case 3:return e.a(2,e.v);case 2:return e.n=3,this.uploadToSingleImageBed(t,n);case 4:return e.a(2)}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"uploadToMultipleImageBeds",value:(v=(0,o.A)((0,r.A)().m(function e(t,n){var a,o,i,s,u,l,c,d,p;return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(a=this.config,o=a.imageBeds,i=a.imageBedStrategy,o&&0!==o.length){e.n=1;break}throw new Error("\u672a\u914d\u7f6e\u4efb\u4f55\u56fe\u5e8a");case 1:if(0!==(s=o.filter(function(e){return e.enabled}).sort(function(e,t){return e.priority-t.priority})).length){e.n=2;break}throw new Error("\u6ca1\u6709\u542f\u7528\u7684\u56fe\u5e8a");case 2:u=this.selectImageBedsByStrategy(s,i),l=0;case 3:if(!(l<u.length)){e.n=10;break}return c=u[l],e.p=4,e.n=5,this.uploadToSpecificImageBed(t,c,n);case 5:return d=e.v,e.a(2,d);case 6:if(e.p=6,p=e.v,!(l<u.length-1&&i.enableFailover)){e.n=8;break}return e.n=7,this.delay(i.retryDelay);case 7:return e.a(3,9);case 8:throw new Error("\u6240\u6709\u56fe\u5e8a\u4e0a\u4f20\u90fd\u5931\u8d25\u4e86: ".concat(p.message));case 9:l++,e.n=3;break;case 10:return e.a(2)}},e,this,[[4,6]])})),function(e,t){return v.apply(this,arguments)})},{key:"selectImageBedsByStrategy",value:function(e,t){switch(t.method){case"priority":case"round-robin":default:return e;case"random":return(0,a.A)(e).sort(function(){return Math.random()-.5})}}},{key:"uploadToSingleImageBed",value:(f=(0,o.A)((0,r.A)().m(function e(t,n){var a,o,i;return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if((a=this.config.imageBed).apiUrl&&a.apiKey){e.n=1;break}throw new Error("\u56fe\u5e8a\u914d\u7f6e\u4e0d\u5b8c\u6574");case 1:e.p=1,i=a.type,e.n="imgbb"===i?2:"smms"===i?4:"chevereto"===i?6:"lsky"===i?8:10;break;case 2:return e.n=3,this.uploadToImgBB(t,null,n);case 3:case 5:case 7:case 9:case 11:return o=e.v,e.a(3,12);case 4:return e.n=5,this.uploadToSMMS(t,null,n);case 6:return e.n=7,this.uploadToChevereto(t,null,n);case 8:return e.n=9,this.uploadToLsky(t,null,n);case 10:return e.n=11,this.uploadToCustom(t,null,n);case 12:return e.a(2,o);case 13:throw e.p=13,e.v;case 14:return e.a(2)}},e,this,[[1,13]])})),function(e,t){return f.apply(this,arguments)})},{key:"uploadToSpecificImageBed",value:(p=(0,o.A)((0,r.A)().m(function e(t,n,a){var o;return(0,r.A)().w(function(e){for(;;)switch(e.n){case 0:o=n.type,e.n="imgbb"===o?1:"smms"===o?3:"chevereto"===o?5:"lsky"===o?7:9;break;case 1:return e.n=2,this.uploadToImgBB(t,n,a);case 2:case 4:case 6:case 8:case 10:return e.a(2,e.v);case 3:return e.n=4,this.uploadToSMMS(t,n,a);case 5:return e.n=6,this.uploadToChevereto(t,n,a);case 7:return e.n=8,this.uploadToLsky(t,n,a);case 9:return e.n=10,this.uploadToCustom(t,n,a);case 11:return e.a(2)}},e,this)})),function(e,t,n){return p.apply(this,arguments)})},{key:"delay",value:function(e){return new Promise(function(t){return setTimeout(t,e)})}},{key:"uploadToImgBB",value:(d=(0,o.A)((0,r.A)().m(function e(t){var n,a,o,i=arguments;return(0,r.A)().w(function(e){for(;;)if(0===e.n)return n=i.length>2?i[2]:void 0,a=(i.length>1&&void 0!==i[1]?i[1]:null)||this.config.imageBed,(o=new FormData).append("image",t),o.append("key",a.apiKey),e.a(2,new Promise(function(e,r){var i=new XMLHttpRequest;n&&i.upload&&i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);n(t)}}),i.addEventListener("load",function(){if(i.status>=200&&i.status<300)try{var n,a=JSON.parse(i.responseText);a.success?e({success:!0,url:a.data.url,fileName:t.name,originalName:t.name,size:t.size}):r(new Error((null===(n=a.error)||void 0===n?void 0:n.message)||"ImgBB\u4e0a\u4f20\u5931\u8d25"))}catch(e){r(new Error("ImgBB\u54cd\u5e94\u89e3\u6790\u5931\u8d25"))}else r(new Error("ImgBB\u4e0a\u4f20\u5931\u8d25: ".concat(i.status," ").concat(i.statusText)))}),i.addEventListener("error",function(){r(new Error("ImgBB\u4e0a\u4f20\u7f51\u7edc\u9519\u8bef"))}),i.addEventListener("timeout",function(){r(new Error("ImgBB\u4e0a\u4f20\u8d85\u65f6"))}),i.open("POST",a.apiUrl),i.send(o)}))},e,this)})),function(e){return d.apply(this,arguments)})},{key:"uploadToSMMS",value:(c=(0,o.A)((0,r.A)().m(function e(t){var n,a,o,i=arguments;return(0,r.A)().w(function(e){for(;;)if(0===e.n)return n=i.length>2?i[2]:void 0,a=(i.length>1&&void 0!==i[1]?i[1]:null)||this.config.imageBed,(o=new FormData).append("smfile",t),e.a(2,new Promise(function(e,r){var i=new XMLHttpRequest;n&&i.upload&&i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);n(t)}}),i.addEventListener("load",function(){if(i.status>=200&&i.status<300)try{var n=JSON.parse(i.responseText);n.success?e({success:!0,url:n.data.url,fileName:t.name,originalName:t.name,size:t.size}):r(new Error(n.message||"SM.MS\u4e0a\u4f20\u5931\u8d25"))}catch(e){r(new Error("SM.MS\u54cd\u5e94\u89e3\u6790\u5931\u8d25"))}else r(new Error("SM.MS\u4e0a\u4f20\u5931\u8d25: ".concat(i.status," ").concat(i.statusText)))}),i.addEventListener("error",function(){r(new Error("SM.MS\u4e0a\u4f20\u7f51\u7edc\u9519\u8bef"))}),i.addEventListener("timeout",function(){r(new Error("SM.MS\u4e0a\u4f20\u8d85\u65f6"))}),i.open("POST",a.apiUrl),a.headers&&Object.keys(a.headers).forEach(function(e){i.setRequestHeader(e,a.headers[e])}),i.send(o)}))},e,this)})),function(e){return c.apply(this,arguments)})},{key:"uploadToChevereto",value:(l=(0,o.A)((0,r.A)().m(function e(t){var n,a,o,i=arguments;return(0,r.A)().w(function(e){for(;;)if(0===e.n)return n=i.length>2?i[2]:void 0,a=(i.length>1&&void 0!==i[1]?i[1]:null)||this.config.imageBed,(o=new FormData).append("source",t),e.a(2,new Promise(function(e,r){var i=new XMLHttpRequest;n&&i.upload&&i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);n(t)}}),i.addEventListener("load",function(){if(i.status>=200&&i.status<300)try{var n,a=JSON.parse(i.responseText);200===a.status_code?e({success:!0,url:a.data.url,fileName:t.name,originalName:t.name,size:t.size}):r(new Error((null===(n=a.error)||void 0===n?void 0:n.message)||"Chevereto\u4e0a\u4f20\u5931\u8d25"))}catch(e){r(new Error("Chevereto\u54cd\u5e94\u89e3\u6790\u5931\u8d25"))}else r(new Error("Chevereto\u4e0a\u4f20\u5931\u8d25: ".concat(i.status," ").concat(i.statusText)))}),i.addEventListener("error",function(){r(new Error("Chevereto\u4e0a\u4f20\u7f51\u7edc\u9519\u8bef"))}),i.addEventListener("timeout",function(){r(new Error("Chevereto\u4e0a\u4f20\u8d85\u65f6"))}),i.open("POST",a.apiUrl),a.headers&&Object.keys(a.headers).forEach(function(e){i.setRequestHeader(e,a.headers[e])}),i.send(o)}))},e,this)})),function(e){return l.apply(this,arguments)})},{key:"uploadToLsky",value:(n=(0,o.A)((0,r.A)().m(function e(t){var n,a,o,i=arguments;return(0,r.A)().w(function(e){for(;;)if(0===e.n)return n=i.length>2?i[2]:void 0,a=(i.length>1&&void 0!==i[1]?i[1]:null)||this.config.imageBed,(o=new FormData).append("file",t),e.a(2,new Promise(function(e,r){var i=new XMLHttpRequest;n&&i.upload&&i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);n(t)}}),i.addEventListener("load",function(){if(i.status>=200&&i.status<300)try{var n=JSON.parse(i.responseText);n.status?e({success:!0,url:n.data.url,fileName:t.name,originalName:t.name,size:t.size}):r(new Error(n.message||"Lsky\u4e0a\u4f20\u5931\u8d25"))}catch(e){r(new Error("Lsky\u54cd\u5e94\u89e3\u6790\u5931\u8d25"))}else r(new Error("Lsky\u4e0a\u4f20\u5931\u8d25: ".concat(i.status," ").concat(i.statusText)))}),i.addEventListener("error",function(){r(new Error("Lsky\u4e0a\u4f20\u7f51\u7edc\u9519\u8bef"))}),i.addEventListener("timeout",function(){r(new Error("Lsky\u4e0a\u4f20\u8d85\u65f6"))}),i.open("POST",a.apiUrl),a.headers&&Object.keys(a.headers).forEach(function(e){i.setRequestHeader(e,a.headers[e])}),i.send(o)}))},e,this)})),function(e){return n.apply(this,arguments)})},{key:"uploadToCustom",value:(t=(0,o.A)((0,r.A)().m(function e(t){var n,a,o,i=arguments;return(0,r.A)().w(function(e){for(;;)if(0===e.n)return n=i.length>2?i[2]:void 0,a=(i.length>1&&void 0!==i[1]?i[1]:null)||this.config.imageBed,(o=new FormData).append("image",t),a.params&&Object.keys(a.params).forEach(function(e){o.append(e,a.params[e])}),e.a(2,new Promise(function(e,r){var i=new XMLHttpRequest;n&&i.upload&&i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);n(t)}}),i.addEventListener("load",function(){if(i.status>=200&&i.status<300)try{var n=JSON.parse(i.responseText),a=null;n.url?a=n.url:n.data&&n.data.url?a=n.data.url:n.link?a=n.link:n.src&&(a=n.src),a?e({success:!0,url:a,fileName:t.name,originalName:t.name,size:t.size}):r(new Error("\u65e0\u6cd5\u4ece\u54cd\u5e94\u4e2d\u83b7\u53d6\u56fe\u7247URL"))}catch(e){r(new Error("\u81ea\u5b9a\u4e49\u56fe\u5e8a\u54cd\u5e94\u89e3\u6790\u5931\u8d25"))}else r(new Error("\u81ea\u5b9a\u4e49\u56fe\u5e8a\u4e0a\u4f20\u5931\u8d25: ".concat(i.status," ").concat(i.statusText)))}),i.addEventListener("error",function(){r(new Error("\u81ea\u5b9a\u4e49\u56fe\u5e8a\u4e0a\u4f20\u7f51\u7edc\u9519\u8bef"))}),i.addEventListener("timeout",function(){r(new Error("\u81ea\u5b9a\u4e49\u56fe\u5e8a\u4e0a\u4f20\u8d85\u65f6"))}),i.open("POST",a.apiUrl),a.headers&&Object.keys(a.headers).forEach(function(e){i.setRequestHeader(e,a.headers[e])}),i.send(o)}))},e,this)})),function(e){return t.apply(this,arguments)})},{key:"uploadImage",value:(e=(0,o.A)((0,r.A)().m(function e(t,n){var a;return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.config.enabled){e.n=1;break}throw new Error("\u56fe\u7247\u4e0a\u4f20\u529f\u80fd\u5df2\u7981\u7528");case 1:if(t.type.startsWith("image/")){e.n=2;break}throw new Error("\u53ea\u652f\u6301\u56fe\u7247\u6587\u4ef6");case 2:if(!(t.size>this.config.maxSize)){e.n=3;break}throw new Error("\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 ".concat(this.formatFileSize(this.config.maxSize)));case 3:if(e.p=3,"webdav"!==this.config.uploadMethod){e.n=5;break}return e.n=4,this.uploadToWebDAV(t,n);case 4:case 6:a=e.v,e.n=8;break;case 5:if("imagebed"!==this.config.uploadMethod){e.n=7;break}return e.n=6,this.uploadToImageBed(t,n);case 7:throw new Error("\u4e0d\u652f\u6301\u7684\u4e0a\u4f20\u65b9\u5f0f");case 8:return a.markdown=this.convertToMarkdown(a.url,t.name),e.a(2,a);case 9:throw e.p=9,e.v;case 10:return e.a(2)}},e,this,[[3,9]])})),function(t,n){return e.apply(this,arguments)})},{key:"convertToMarkdown",value:function(e){return"![".concat((arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")||"\u56fe\u7247","](").concat(e,")")}},{key:"formatFileSize",value:function(e){if(0===e)return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}},{key:"isConfigValid",value:function(){if(!this.config.enabled)return!1;if("webdav"===this.config.uploadMethod){var e=this.config.webdav;return!!(e.serverUrl&&e.username&&e.password&&e.publicUrl)}if("imagebed"===this.config.uploadMethod){if(this.config.imageBeds&&this.config.imageBeds.length>0)return this.config.imageBeds.some(function(e){return e.enabled&&e.apiUrl&&e.apiKey});var t=this.config.imageBed;return!(!t.apiUrl||!t.apiKey)}return!1}},{key:"getConfigInfo",value:function(){return{enabled:this.config.enabled,uploadMethod:this.config.uploadMethod,maxFiles:this.config.maxFiles,maxSize:this.config.maxSize,configValid:this.isConfigValid()}}}]);var e,t,n,l,c,d,p,f,v,m,g}())},82914:(e,t,n)=>{n.d(t,{A:()=>S});var a=n(59258),r=n(20908),o=n(3604),i=n(30388),s=(n(28706),n(51629),n(23418),n(44114),n(54554),n(59089),n(18111),n(7588),n(2892),n(9868),n(26099),n(78459),n(47764),n(11392),n(23500),n(62953),n(3296),n(27208),n(48408),n(14603),n(47566),n(98721),n(20641)),u=n(50953),l=n(90033),c=n(53751),d=n(98120),p=n(46992),f=n(77137),v=n(80394),m={class:"image-upload-container"},g={key:0,class:"config-warning"},h=["src","alt"],k={class:"image-overlay"},w=["onClick"],y=["onClick","title"],b={class:"progress-bar"},E={class:"progress-text"},L={key:1,class:"markdown-indicator"},A={class:"upload-content"},T={class:"upload-text"},C={class:"upload-hint"},M={key:2,class:"error-message"};const B={__name:"ImageUpload",props:{images:{type:Array,default:function(){return[]}},maxFiles:{type:Number,default:null},maxSize:{type:Number,default:null},disabled:{type:Boolean,default:!1},enableMarkdown:{type:Boolean,default:!0},autoInsertMarkdown:{type:Boolean,default:!1}},emits:["update:images","upload-success","upload-error","markdown-ready"],setup:function(e,t){var n=t.emit,B=(0,p.s9)().t,S=e,I=n,U=(0,u.KR)(null),F=(0,u.KR)(!1),R=(0,u.KR)(""),z=(0,s.EW)(function(){return S.images||[]}),x=(0,s.EW)(function(){return v.TICKET_CONFIG.imageUpload}),_=(0,s.EW)(function(){return S.maxFiles||x.value.maxFiles}),D=(0,s.EW)(function(){return S.maxSize||x.value.maxSize}),N=(0,s.EW)(function(){return f.default.isConfigValid()}),W=(0,s.EW)(function(){return N.value?z.value.length>0?B("imageUpload.addMoreImages"):B("imageUpload.dragDropOrClick"):B("imageUpload.configInvalid")}),X=(0,s.EW)(function(){var e=B("imageUpload.supportedFormats",{maxSize:J(D.value)});return"".concat(e," \u2022 ").concat(B("imageUpload.pasteImage"))}),O=function(){var e;!S.disabled&&N.value&&(null===(e=U.value)||void 0===e||e.click())},H=function(e){var t=Array.from(e.target.files);Q(t),e.target.value=""},P=function(e){!S.disabled&&N.value&&(F.value=!0)},K=function(e){F.value=!1},q=function(e){if(!S.disabled&&N.value){F.value=!1;var t=Array.from(e.dataTransfer.files);Q(t)}},V=function(e){e.target.closest(".image-upload-container")&&function(e){var t;if(!S.disabled&&N.value){var n=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(n){for(var a=[],r=0;r<n.length;r++){var o=n[r];if(o.type.startsWith("image/")){var i=o.getAsFile();i&&a.push(i)}}a.length>0&&(e.preventDefault(),Q(a))}}}(e)},Q=function(){var e=(0,i.A)((0,r.A)().m(function e(t){var n,a,i,s;return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(R.value="",!(z.value.length+t.length>_.value)){e.n=1;break}return R.value=B("imageUpload.tooManyFiles",{max:_.value}),e.a(2);case 1:n=(0,o.A)(t),e.p=2,n.s();case 3:if((a=n.n()).done){e.n=7;break}if((i=a.value).type.startsWith("image/")){e.n=4;break}return R.value=B("imageUpload.invalidFileType"),e.a(3,6);case 4:if(!(i.size>D.value)){e.n=5;break}return R.value=B("imageUpload.fileTooLarge",{maxSize:J(D.value)}),e.a(3,6);case 5:return e.n=6,$(i);case 6:e.n=3;break;case 7:e.n=9;break;case 8:e.p=8,s=e.v,n.e(s);case 9:return e.p=9,n.f(),e.f(9);case 10:return e.a(2)}},e,null,[[2,8,9,10]])}));return function(t){return e.apply(this,arguments)}}(),$=function(){var e=(0,i.A)((0,r.A)().m(function e(t){var n,o,i,s,u,l,c;return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=z.value.length,o={file:t,url:URL.createObjectURL(t),uploading:!0,progress:0,id:Date.now()+n,markdown:null},i=[].concat((0,a.A)(z.value),[o]),I("update:images",i),e.p=1,s=function(e){o.progress=e;var t=(0,a.A)(z.value);I("update:images",t)},e.n=2,f.default.uploadImage(o.file,s);case 2:u=e.v,o.progress=100,o.uploadedUrl=u.url,o.uploading=!1,l=(0,a.A)(z.value),I("update:images",l),S.enableMarkdown&&u.markdown&&(o.markdown=u.markdown,S.autoInsertMarkdown&&I("markdown-ready",u.markdown)),I("upload-success",{id:o.id,url:u.url,file:o.file,markdown:u.markdown}),e.n=4;break;case 3:e.p=3,c=e.v,R.value=c.message||B("imageUpload.uploadFailed"),j(n);case 4:return e.a(2)}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}(),j=function(e){var t=z.value[e];t.url&&t.url.startsWith("blob:")&&URL.revokeObjectURL(t.url);var n=(0,a.A)(z.value);n.splice(e,1),I("update:images",n)},G=function(){var e=(0,i.A)((0,r.A)().m(function e(t){return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,navigator.clipboard.writeText(t);case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),J=function(e){if(0===e)return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]};return(0,s.sV)(function(){document.addEventListener("paste",V)}),(0,s.hi)(function(){document.removeEventListener("paste",V),z.value.forEach(function(e){e.url&&e.url.startsWith("blob:")&&URL.revokeObjectURL(e.url)})}),function(t,n){return(0,s.uX)(),(0,s.CE)("div",m,[N.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",g,[(0,s.bF)((0,u.R1)(d.GBC),{size:16}),(0,s.Lk)("span",null,(0,l.v_)(t.$t("imageUpload.configInvalid")),1)])),z.value.length>0?((0,s.uX)(),(0,s.CE)("div",{class:"image-preview-area",key:"preview-"+z.value.length},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(z.value,function(e,n){return(0,s.uX)(),(0,s.CE)("div",{key:e.id||n,class:"image-preview-item"},[(0,s.Lk)("img",{src:e.url,alt:"\u56fe\u7247 ".concat(n+1),class:"preview-image"},null,8,h),(0,s.Lk)("div",k,[(0,s.Lk)("button",{class:"remove-btn",onClick:function(e){return j(n)}},[(0,s.bF)((0,u.R1)(d.MRt),{size:16})],8,w),e.markdown?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"copy-markdown-btn",onClick:function(t){return G(e.markdown)},title:t.$t("imageUpload.copyMarkdown")},[(0,s.bF)((0,u.R1)(d.bzS),{size:14})],8,y)):(0,s.Q3)("",!0)]),e.uploading||e.progress>0?((0,s.uX)(),(0,s.CE)("div",{class:"upload-progress",key:"progress-"+e.id},[(0,s.Lk)("div",b,[(0,s.Lk)("div",{class:"progress-fill",style:(0,l.Tr)({width:e.progress+"%"})},null,4)]),(0,s.Lk)("span",E,(0,l.v_)(Math.round(e.progress))+"%",1)])):(0,s.Q3)("",!0),e.markdown?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.bF)((0,u.R1)(d.Dl3),{size:12})])):(0,s.Q3)("",!0)])}),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,l.C4)(["upload-area",{"drag-over":F.value,"has-images":z.value.length>0,disabled:e.disabled||!N.value}]),onClick:O,onDragover:(0,c.D$)(P,["prevent"]),onDragleave:(0,c.D$)(K,["prevent"]),onDrop:(0,c.D$)(q,["prevent"])},[(0,s.Lk)("div",A,[(0,s.bF)((0,u.R1)(d.nre),{size:32,class:"upload-icon"}),(0,s.Lk)("p",T,(0,l.v_)(W.value),1),(0,s.Lk)("p",C,(0,l.v_)(X.value),1)]),(0,s.Lk)("input",{ref_key:"fileInput",ref:U,type:"file",multiple:"",accept:"image/*",onChange:H,style:{display:"none"}},null,544)],34),R.value?((0,s.uX)(),(0,s.CE)("div",M,(0,l.v_)(R.value),1)):(0,s.Q3)("",!0)])}}};const S=(0,n(66262).A)(B,[["__scopeId","data-v-f2c685d2"]])}}]);